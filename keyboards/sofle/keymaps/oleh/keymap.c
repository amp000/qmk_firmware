/* Copyright 2021 HellSingCoder
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

#include QMK_KEYBOARD_H

#ifdef ENCODER_MAP_ENABLE
// @IMPORTANT
// amount of elements here has to match amount of elements in keymaps array
const uint16_t PROGMEM encoder_map[][NUM_ENCODERS][NUM_DIRECTIONS] = {
    [0] = { ENCODER_CCW_CW(KC_VOLD, KC_VOLU),           ENCODER_CCW_CW(KC_PGDN, KC_PGUP) }
    // [1] = { ENCODER_CCW_CW(_______, _______),           ENCODER_CCW_CW(_______, _______) },
    // [2] = { ENCODER_CCW_CW(RGB_HUD, RGB_HUI),           ENCODER_CCW_CW(RGB_SAD, RGB_SAI) },
    // [3] = { ENCODER_CCW_CW(RGB_VAD, RGB_VAI),           ENCODER_CCW_CW(RGB_RMOD, RGB_MOD)},
    // [4] = { ENCODER_CCW_CW(RGB_VAD, RGB_VAI),           ENCODER_CCW_CW(RGB_RMOD, RGB_MOD)},
    // [5] = { ENCODER_CCW_CW(RGB_VAD, RGB_VAI),           ENCODER_CCW_CW(RGB_RMOD, RGB_MOD)}
};
#endif

enum sofle_layers {
    _BASE_0,
    _BASE_1,
    _NUM,
    _HACK,
    _WOW,
    _GAME,
};

//TODO: maybe not?
//needs to have same num of keycodes as sofle_layers ?
// enum custom_keycodes {
//     KC_BASE_0 = SAFE_RANGE,
//     KC_BASE_1,
//     KC_NUM,
//     KC_HACK,
//     KC_WOW,
//     KC_GAME,
// };


// clang-format off

// @IMPORTANT
// amount of elements here has to match amount of elements in encoder_map array
const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
    /*
     * QWERTY
     * ,-----------------------------------------.                    ,-----------------------------------------.
     * | Esc  |   1  |   2  |   3  |   4  |   5  |                    |   6  |   7  |   8  |   9  |   0  |  BS  |
     * |------+------+------+------+------+------|                    |------+------+------+------+------+------|
     * | Tab  |   Q  |   W  |   E  |   R  |   T  |                    |   Y  |   U  |   I  |   O  |   P  |  `   |
     * |------+------+------+------+------+------|                    |------+------+------+------+------+------|
     * | Caps |   A  |   S  |   D  |   F  |   G  |-------.    ,-------|   H  |   J  |   K  |   L  |   ;  |  '   |
     * |------+------+------+------+------+------|  play |    | mute  |------+------+------+------+------+------|
     * |LShift|   Z  |   X  |   C  |   V  |   B  |-------|    |-------|   N  |   M  |   ,  |   .  |   /  |  \   |
     * `-----------------------------------------/       /     \      \-----------------------------------------'
     *            | LGUI | LAlt | LAYER| LCTR | /Enter  /       \Space \  |  [   |  ]   |  -   |  =   |
     *            |      |      |      |      |/       /         \      \ |      |      |      |      |
     *            `----------------------------------'           '------''---------------------------'
     */

// NON FINAL LAYOUT AS BACKUP IF VIA FAILS
[_BASE_0] = LAYOUT(
  KC_ESC,   KC_1,   KC_2,    KC_3,    KC_4,    KC_5,                     KC_6,    KC_7,    KC_8,    KC_9,    KC_0,  KC_GRV,
  KC_TAB,   KC_Q,   KC_W,    KC_E,    KC_R,    KC_T,                     KC_Y,    KC_U,    KC_I,    KC_O,    KC_P, KC_ENT,
  MT(MOD_LCTL, KC_ESC),   KC_A,   KC_S,    KC_D,    KC_F,    KC_G,                     KC_H,    KC_J,    KC_K,    KC_L, KC_SCLN,  KC_QUOT,
  KC_LSFT,  KC_Z,   KC_X,    KC_C,    KC_V,    KC_B, KC_B,     KC_B, KC_N,    KC_M, KC_COMM,  KC_DOT, KC_SLSH,  KC_BSLS,
                 KC_LGUI,KC_LGUI,KC_LALT, KC_V, KC_SPC,      KC_BSPC,  KC_M, KC_RBRC, KC_MINS, KC_EQL
)
};
// clang-format on

#ifdef OLED_ENABLE

/* 32 * 32 logo */
static void render_logo(void) {
    static const char PROGMEM hell_logo[] = {                  
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80, 0xfc, 0xc0, 0xa0, 0x90, 0x88, 0x88, 0x04, 0x04, 
0x04, 0x04, 0x88, 0x88, 0x90, 0xa0, 0xc0, 0xfc, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x10, 0x08, 0x04, 0x02, 0x01, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0x01, 0x02, 0x04, 0x08, 0x10, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x20, 0x20, 0x70, 0xf8, 0x70, 0x20, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 
0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x20, 0x30, 0x30, 0x70, 0x70, 0x70, 0x70, 0x70, 0xff, 
0xff, 0xff, 0x70, 0x70, 0x70, 0x70, 0x70, 0x30, 0x30, 0x20, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3f, 
0xff, 0x0f, 0x00, 0x00, 0x10, 0x38, 0xfe, 0x38, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x40, 0x40, 0xc0, 0x40, 0x40, 0xc0, 0x60, 
0x60, 0xc0, 0x40, 0x40, 0xc0, 0x40, 0x40, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0xe0, 0x58, 0x44, 0x42, 0x41, 0x43, 0xf2, 0x4c, 0x46, 0x49, 0x48, 0xfc, 0x4b, 0x48, 0x48, 
0x48, 0x48, 0x4b, 0xfc, 0x48, 0x49, 0x46, 0x4c, 0xf2, 0x43, 0x41, 0x42, 0x44, 0x58, 0xe0, 0x00, 
0x00, 0x00, 0x03, 0x04, 0x08, 0x10, 0x18, 0x29, 0x26, 0x4c, 0x52, 0x62, 0x47, 0x5a, 0x62, 0xc2, 
0xc2, 0x62, 0x5a, 0x47, 0x62, 0x52, 0x4c, 0x26, 0x29, 0x18, 0x10, 0x08, 0x04, 0x03, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0xe0, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x00, 
0x00, 0x00, 0x80, 0xc0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0x1f, 0x18, 0x0c, 0x0c, 0x0c, 0x1c, 0xf8, 0xf8, 0xe0, 
0x00, 0x03, 0x07, 0x03, 0x01, 0x00, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x07, 0x06, 0x0e, 0x0c, 0x0c, 0x0c, 0x0e, 0x07, 0x07, 0x01, 
0x00, 0x00, 0x0c, 0x0c, 0x0c, 0x0c, 0x0f, 0x0f, 0x0f, 0x0c, 0x0c, 0x0c, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00        
                                                                                  
    };

    oled_write_raw_P(hell_logo, sizeof(hell_logo));
}

static void print_logo_narrow(void) {
    render_logo();
}

static void render_skull(void) {
    static const char PROGMEM skull[] = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xe0, 0xf0, 0xf8, 0xfc, 0xfc, 0xfe, 0xfe, 0xfe, 
0xfe, 0xfe, 0xfe, 0xfe, 0xfc, 0xfc, 0xf8, 0xf0, 0xe0, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f, 0xff, 0xe7, 0x9f, 0x7f, 0x7f, 0x6f, 0x6f, 0xcf, 0xff, 
0xff, 0xff, 0xcf, 0x6f, 0x6f, 0x7f, 0x7f, 0x9f, 0xe7, 0xff, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x3f, 0x78, 0x70, 0x70, 0xf8, 0xf8, 0xfc, 0x8f, 
0xc7, 0x8f, 0xfc, 0xf8, 0xf8, 0x70, 0x70, 0x78, 0x3f, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0x20, 0x7b, 0xc0, 0xf7, 0xc0, 
0xf7, 0xc0, 0xf7, 0xc0, 0x7b, 0x20, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    };

    oled_write_raw_P(skull, sizeof(skull));
}


static void render_smile(void) {
    static const char PROGMEM smile[] = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x40, 0x40, 0x20, 0x20, 0x20, 0x10, 0x10, 
0x10, 0x10, 0x20, 0x20, 0x20, 0x40, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x80, 0x70, 0x0c, 0x02, 0x01, 0x00, 0x00, 0x00, 0x00, 0x78, 0x7c, 0x00, 0x00, 
0x00, 0x00, 0x7c, 0x78, 0x00, 0x00, 0x00, 0x00, 0x01, 0x02, 0x0c, 0x70, 0x80, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x07, 0x38, 0xc0, 0x00, 0x0e, 0x1f, 0x30, 0x60, 0xc0, 0x80, 0x80, 0x00, 0x00, 
0x00, 0x00, 0x80, 0x80, 0xc0, 0x60, 0x30, 0x1f, 0x0e, 0x00, 0xc0, 0x38, 0x07, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x02, 0x04, 0x08, 0x08, 0x10, 0x10, 0x11, 0x21, 0x21, 
0x21, 0x21, 0x11, 0x10, 0x10, 0x08, 0x08, 0x04, 0x02, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    };

    oled_write_raw_P(smile, sizeof(smile));
}

static void render_wow(void) {
    static const char PROGMEM wow[] = {
0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x40, 0x40, 0x20, 0x20, 0x20, 0x10, 0x10, 
0x10, 0x10, 0x20, 0x20, 0x20, 0x40, 0x40, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x80, 0x70, 0x0f, 0x03, 0x01, 0x00, 0x00, 0xf8, 0xf8, 0xf8, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0xf8, 0xf8, 0xf8, 0x00, 0x00, 0x01, 0x03, 0x0f, 0x70, 0x80, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x07, 0x38, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x03, 0x0f, 0x7f, 0x7e, 0x78, 0x0f, 
0x0f, 0x78, 0x7e, 0x7f, 0x0f, 0x03, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x38, 0x07, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x07, 0x06, 0x04, 0x08, 0x08, 0x10, 0x10, 0x10, 0x20, 0x20, 
0x20, 0x20, 0x10, 0x10, 0x10, 0x08, 0x08, 0x04, 0x06, 0x07, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00
    };

    oled_write_raw_P(wow, sizeof(wow));
}

static void print_status_narrow(void) {
    /* Print current mode */

    oled_set_cursor(0, 3);

    // switch (get_highest_layer(default_layer_state)) {
    //     case _BASE_0:
    //         oled_write("QWRTY", false);
    //         break;
    //     case _GAME0:
    //         oled_write("GAMES", false);
    //         break;
    //     default:
    //         oled_write("UNDEF", false);
    // }

    // write the base layer
    oled_set_cursor(0, 3);
    oled_write("BASE", false);
    oled_set_cursor(0, 4);
    switch (get_highest_layer(default_layer_state)) {
        case _BASE_0:
            oled_write("0:def", false);
            break;
        case _BASE_1:
            oled_write("1:???", false);
            break;
        case _WOW:
            oled_write("4:wow", false);
            break;
        case _GAME:
            oled_write("5:gam", false);
            break;
        default:
            oled_write("UNDEF", false);
    }

    oled_set_cursor(0, 6);
    oled_write("TEMP", false);
    oled_set_cursor(0, 7);
    // write the "temp" layer (numbers or hacking)
    switch (get_highest_layer(layer_state)) {
        case _NUM:
            oled_write("2:num", false);
            break;
        case _HACK:
            oled_write("3:hck", false);
            break;
        // this layer is disabled, VIA doesn't support more than 4
        // case _ADJUST:
        //     oled_write("Adj  ", false);
        //     break;
        default:
            oled_write("-----", false);
    }

    // draw the gamer skull or happy smile
    oled_set_cursor(0, 12);
    switch (get_highest_layer(default_layer_state)) {
        case _BASE_0:
            render_smile();
            break;
        case _BASE_1:
            render_smile();
            break;
        case _WOW:
            render_wow();
            break;
        case _GAME:
            render_skull();
            break;
        default:
            oled_write("UNDEF", false);
    }

}

oled_rotation_t oled_init_user(oled_rotation_t rotation) { return OLED_ROTATION_270; }

bool oled_task_user(void) {

    // check what screen are we on (master is left)
    if (is_keyboard_master()) {
        print_status_narrow();
    } else {
        print_logo_narrow();
    }
    return false;
}

#endif
